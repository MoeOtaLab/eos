var pe=Object.defineProperty,ge=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var j=(t,e,n)=>e in t?pe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,y=(t,e)=>{for(var n in e||(e={}))fe.call(e,n)&&j(t,n,e[n]);if(K)for(var n of K(e))he.call(e,n)&&j(t,n,e[n]);return t},C=(t,e)=>ge(t,_e(e));var S=(t,e,n)=>(j(t,typeof e!="symbol"?e+"":e,n),n);import{w as me,j as s,R as be,h as Se,E as ve,r as _,u as ye,F as I,i as P,a as f,c as T,b as M,H as xe,P as X,d as Y,e as J,f as $e,g as we,B as Ce,k as Me,l as Oe,m as Ie,n as Pe,o as Te,p as Ee,q as F,s as Ne,S as Q,t as He,v as Le,x as Re}from"./vendor.492dbb80.js";const je=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}};je();const k=me({elements:[],setElements:()=>{},updateElement:()=>{}});function Fe(){return Se(k)}function V(t){return ve(k,t)}function ke(){return{elements:V(e=>e.elements)}}const Ve=t=>{const{children:e}=t,[n,o]=_.exports.useState([]),r=ye(),a=_.exports.useCallback((i,d,u)=>{!i||(o(l=>{var h;const c=l.findIndex(L=>L.id===i);if(c<0)return l;const g=[...l],p=(h=g.splice(c,1))==null?void 0:h[0],m=typeof d=="function"?d(p):d;return g.concat(m)}),u&&setTimeout(()=>{r(i)},0))},[r]);return s(k.Provider,{value:{elements:n,setElements:o,updateElement:a},children:e})},Ae=t=>{const{children:e}=t;return s(be,{children:s(Ve,{children:e})})};function De(){return`$flow_${Math.random().toString(36).substr(2,5)}`}function Be(t,e){return t.target===e.target&&t.targetHandle===e.targetHandle}function qe(t,e){return t.source===e.source&&t.sourceHandle===e.sourceHandle}class E{constructor(e="Operator",n){S(this,"id",De());S(this,"position",{x:0,y:0});S(this,"type","OperatorNode");S(this,"data",{});S(this,"style");S(this,"className");S(this,"targetPosition");S(this,"sourcePosition");S(this,"isHidden");S(this,"draggable");S(this,"selectable");S(this,"connectable");Object.assign(this,C(y({},n),{data:y(y({operatorType:e},this.data),n==null?void 0:n.data)}))}static generateOperatorIcon(){return s("div",{children:this.name})}static generateAttributeControl(e){const{value:n,actions:o}=e;function r(a){n.data.label=a,o.updateElement(n.id,n)}return s(I,{children:s("input",{placeholder:"input label",style:{width:"100%",maxWidth:"none"},value:n.data.label,onChange:a=>r(a.target.value)})})}static generateOperation(e){return""}}var ze={"attribute-control":"_attribute-control_w1f3b_1"};const $="logicStateStore";function Z(t){const e=t.filter(o=>P(o)),n=new Map(t.filter(o=>!P(o)).map(o=>[o.id,{id:o.id,operator:o,sourceLink:{}}]));return e.forEach(o=>{const r=n.get(o.target),a=n.get(o.source);if(!r||!a||!(o==null?void 0:o.targetHandle)||!(o==null?void 0:o.sourceHandle)){console.warn("found useless target/source edge: ",o);return}if(r.sourceLink[o.targetHandle]){console.warn("found duplicate input source: ",o);return}r.sourceLink[o.targetHandle]={target:a,handler:o.sourceHandle}}),[...n.values()]}function We(t){const e=Z(t),n=`
    const ${$} = new Map();
    // initial
    ${e.map(a=>`
      ${$}.set('${a.id}', new Rx.Subject());
    `).join(`
`)}
  `,o=e.map(a=>{var u,l,c;return`
      (function () {
        let exports;
        ${(c=N.get((l=(u=a.operator)==null?void 0:u.data)==null?void 0:l.operatorType))==null?void 0:c.generateOperation(a)}
        const recordOnlySubject = ${$}.get('${a.id}');
        exports?.subscribe(value => recordOnlySubject?.next(value));
      })();
    `}).join(`
`),r=`
    function main() {
      ${n}
      ${o}
      return ${$};
    }

    main();
  `;return console.log(r),r}function A(...t){return t.flat(1/0).filter(Boolean).join(`
`)}function ee(t,e){return`const ${e} = ${$}.get('${t}');`}function te(t){return`[${t.join(",")}]`}function Ue(t,e,...n){return`${e?`const ${e} = `:""}${t}(${n.join(", ")});`}function Ge(t){return`{${Object.entries(t).map(([e,n])=>`${e}: ${n}`).join(",")}}`}function D(t){return typeof t=="object"?`exports = ${Ge(t)}`:`exports = ${t}`}class Ke extends E{constructor(e){super("AddOperator",e);this.data=y(C(y({},this.data),{targetPorts:[{label:"Input_1",id:"Input_1"},{label:"Input_2",id:"Input_2"}],sourcePorts:[{label:"Result",id:"Result"}]}),e==null?void 0:e.data)}static generateAttributeControl(e){const{value:n,actions:o}=e,r=n.data.targetPorts||[],a=()=>{const d={label:`Input_${r.length+1}`,id:`Input_${r.length+1}`};n.data.targetPorts=r.concat(d),o.updateElement(n.id,n,!0)},i=()=>{var d;r.length>1&&((d=n.data.targetPorts)==null||d.pop(),o.updateElement(n.id,n,!0))};return f("div",{className:ze["attribute-control"],children:[E.generateAttributeControl(e),s("button",{onClick:a,children:"add Input Port"}),s("button",{disabled:r.length<=1,onClick:i,children:"delete Input Port"})]})}static generateOperation(e){const n=Object.entries(e.sourceLink),o=A(n.map(([r,a])=>ee(a.target.id,r)),Ue("operations.AddOperator.addOperation","addResult$",te(n.map(([r])=>r)),te(n.map(([,r])=>`'${r.handler}'`))),D("addResult$"));return console.log(o),o}}class Xe extends E{static generateAttributeControl(e){var a;const{value:n,actions:o}=e;function r(i){n.data.dataSourceId=i,o.updateElement(n.id,n)}return f("div",{children:[super.generateAttributeControl(e),s("label",{children:"\u8BF7\u9009\u62E9\u6570\u636E\u6765\u6E90"}),s("input",{value:((a=n.data)==null?void 0:a.dataSourceId)||"",onChange:i=>r(i.target.value)})]})}constructor(e){super("SourceOperator",e);this.data=y(C(y({},this.data),{sourcePorts:[{label:"Source",id:"Source"}]}),e==null?void 0:e.data)}static generateOperation(e){return A(`const result = link.getValueSource('${e.operator.data.dataSourceId}');`,`console.log({result, type: '${e.operator.data.dataSourceId}'})`,D("result"))}}class Ye extends E{static generateAttributeControl(e){var a;const{value:n,actions:o}=e;function r(i){n.data.dataSourceId=i,o.updateElement(n.id,n)}return f("div",{children:[super.generateAttributeControl(e),s("label",{children:"\u8BF7\u9009\u62E9\u8F93\u51FA\u4F4D\u7F6E"}),s("input",{value:((a=n.data)==null?void 0:a.dataSourceId)||"",onChange:i=>r(i.target.value)})]})}constructor(e){super("TargetOperator",e);this.data=y(C(y({},this.data),{targetPorts:[{label:"Target",id:"Target"}],dataSourceId:"input8"}),e==null?void 0:e.data)}static generateOperation(e){const n=Object.values(e.sourceLink)[0];return A(ee(n.target.id,"target"),D("target"))}}const Je={AddOperator:Ke,SourceOperator:Xe,TargetOperator:Ye},N=new Map(Object.entries(Je)),Qe="_container_1bovl_1",Ze="_content_1bovl_6";var B={container:Qe,content:Ze};const q="model",et=()=>{const t=e=>n=>{n.dataTransfer.setData(q,e),n.dataTransfer.dropEffect="copy",n.dataTransfer.effectAllowed="all"};return f("div",{className:B.container,children:[s("div",{className:B.title,children:"Operator Panel"}),s("div",{className:B.content,children:[...N.entries()].map(([e,n])=>s("div",{style:{cursor:"pointer"},draggable:!0,onDragStart:t(e),children:(n==null?void 0:n.generateOperatorIcon())||e},e))})]})},tt="_node__container_1uch9_1",nt="_node__content_1uch9_11",rt="_source_1uch9_84",ot="_target_1uch9_112",at="_node__title_1uch9_143";var b={node__container:tt,node__content:nt,"is-selected":"_is-selected_1uch9_20","node__port-list":"_node__port-list_1uch9_23","is-sub-list":"_is-sub-list_1uch9_37","node__port-children":"_node__port-children_1uch9_40","node__port-dot":"_node__port-dot_1uch9_57","is-last":"_is-last_1uch9_66",source:rt,target:ot,node__title:at,"node__port-expand-trigger":"_node__port-expand-trigger_1uch9_148","is-children-hidden":"_is-children-hidden_1uch9_163","node__port-expand-line":"_node__port-expand-line_1uch9_174","node__port-label":"_node__port-label_1uch9_187"};const ne=t=>{const{value:e=[],type:n,nestLevel:o=0}=t,[r,a]=_.exports.useState([]);function i(u){return!(r==null?void 0:r.includes(u))}function d(u){return()=>{a(l=>{const c=[...l];return(c==null?void 0:c.includes(u))?c.splice(c.indexOf(u)):c.push(u),c})}}return s("ul",{className:T(b["node__port-list"],b[n],{[b["is-sub-list"]]:o}),style:{"--nest-level":o},children:e.map((u,l)=>{var p,m;const c=Boolean((p=u==null?void 0:u.children)==null?void 0:p.length),g=i(u.id);return f(M.Fragment,{children:[f("li",{className:T({[b["node__port-expand"]]:c,[b["is-last"]]:l===e.length-1}),children:[Boolean(o)&&!c&&s("div",{className:b["node__port-dot"]}),c&&f(I,{children:[s("div",{className:T(b["node__port-expand-trigger"],{[b["is-children-hidden"]]:g}),onClick:d(u.id),children:s("svg",{viewBox:"0 0 1024 1024",focusable:"false","data-icon":"caret-down",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:s("path",{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"})})}),!g&&s("div",{className:b["node__port-expand-line"]})]}),s("div",{className:b["node__port-label"],children:u.label}),s(xe,{type:n,position:n==="source"?X.Right:X.Left,id:u.id,isConnectable:(m=u.isConnectable)!=null?m:!0})]}),!g&&c&&s("li",{className:b["node__port-children"],children:s(ne,{value:u.children,nestLevel:o+1,type:n})})]},u.id)})})},st=t=>{const{data:e,selected:n}=t,o=e==null?void 0:e.operatorType,r=[{type:"source",value:e.sourcePorts},{type:"target",value:e.targetPorts}];return f("div",{className:T(b.node__container,{[b["is-selected"]]:n}),children:[o,f("div",{className:b.node__content,children:[s("div",{className:b.node__title,children:e.label}),r==null?void 0:r.map(({type:a,value:i})=>(i==null?void 0:i.length)?s(ne,{type:a,value:i},a):null)]})]})},ct={OperatorNode:st};var it={"main-flow":"_main-flow_1t4yy_1"};const ut=[{id:"$flow_slgum",position:{x:966,y:99},type:"OperatorNode",data:{operatorType:"TargetOperator",targetPorts:[{label:"Target",id:"Target"}]},style:{visibility:"visible"}},{id:"$flow_5i9q0",position:{x:530,y:115},type:"OperatorNode",data:{operatorType:"AddOperator",targetPorts:[{label:"Input_1",id:"Input_1"},{label:"Input_2",id:"Input_2"}],sourcePorts:[{label:"Result",id:"Result"}]},style:{visibility:"visible"}},{source:"$flow_x3gaw",sourceHandle:"Source",target:"$flow_5i9q0",targetHandle:"Input_1",id:"reactflow__edge-$flow_x3gawSource-$flow_5i9q0Input_1"},{source:"$flow_qekmc",sourceHandle:"Source",target:"$flow_5i9q0",targetHandle:"Input_2",id:"reactflow__edge-$flow_qekmcSource-$flow_5i9q0Input_2"},{source:"$flow_5i9q0",sourceHandle:"Result",target:"$flow_slgum",targetHandle:"Target",id:"reactflow__edge-$flow_5i9q0Result-$flow_slgumTarget"},{id:"$flow_x3gaw",position:{x:319,y:122},type:"OperatorNode",data:{operatorType:"SourceOperator",sourcePorts:[{label:"Source",id:"Source"}],dataSourceId:"value"},style:{visibility:"visible"}},{id:"$flow_qekmc",position:{x:289,y:229},type:"OperatorNode",data:{operatorType:"SourceOperator",sourcePorts:[{label:"Source",id:"Source"}],dataSourceId:"value2"},style:{visibility:"visible"}}],lt=()=>{const{elements:t,setElements:e}=Fe();_.exports.useEffect(()=>{e(ut)},[]),console.log({elements:t});const n=c=>e(g=>Ie(c,g)),o=Y(c=>c.addSelectedElements),r=c=>{const g=Pe(c,t).filter(p=>!(P(p)&&!qe(p,c)&&Be(p,c)));e(g),setTimeout(()=>{const p=g.find(m=>{const h=c;return P(m)&&m.source===h.source&&m.target===h.target&&(m.sourceHandle===h.sourceHandle||!m.sourceHandle&&!h.sourceHandle)&&(m.targetHandle===h.targetHandle||!m.targetHandle&&!h.targetHandle)});o([p].filter(Boolean))})},a=_.exports.useRef(null),i=Y(c=>c.updateNodePos),d=_.exports.useRef([]);J(c=>(d.current=c.nodes,d));const u=c=>{var m;const g=c.dataTransfer.getData(q),p=N.get(g);if(p){const h=new p,{clientX:L,clientY:le}=c,R=(m=a.current)==null?void 0:m.getBoundingClientRect();R&&(h.position={x:L-R.left,y:le-R.y},h.style={visibility:"hidden"}),e(v=>[...v,h]),setTimeout(()=>{var G;const v=d.current.find(x=>x.id===h.id);if(v){const x={x:((G=v==null?void 0:v.position)==null?void 0:G.x)-(v==null?void 0:v.__rf.width)/2,y:v.position.y-Math.max(v.__rf.height/5,30)};i({id:v.id,pos:x})}e(x=>(x.find(de=>de.id===h.id)&&(h.style={visibility:"visible"}),[...x]))})}},l=c=>{c.dataTransfer.types.includes(q)&&c.preventDefault()};return s("div",{className:it["main-flow"],ref:a,onDrop:u,onDragEnter:l,onDragOver:l,children:f($e,{nodeTypes:ct,elements:t,onElementsRemove:n,onConnect:r,zoomOnScroll:!1,children:[s(we,{variant:Ce.Lines,gap:200,color:"rgba(255,255,255,0.1)",size:1}),s(Me,{}),s(Oe,{})]})})},dt=()=>{var d,u;const t=J(l=>{var c;return(c=l.selectedElements)==null?void 0:c.filter(g=>Te(g))}),e=t==null?void 0:t[0],n=V(l=>l.elements.find(c=>c.id===(e==null?void 0:e.id))),o=(d=n==null?void 0:n.data)==null?void 0:d.operatorType,r=N.get(o),a=(t==null?void 0:t.length)===1&&o,i=V(l=>l.updateElement);return f("div",{children:[s("div",{children:"Attribute Panel"}),a&&((u=r==null?void 0:r.generateAttributeControl)==null?void 0:u.call(r,{value:n,actions:{updateElement:i}}))]})};function pt(t){return t.reduce((e,n)=>e+Number(n),0)}function gt(t,e=[]){return Ee(t).pipe(F(n=>n.map((o,r)=>{const a=e[r];return typeof o=="object"&&a?o[a]:o}))).pipe(F(pt))}var _t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",addOperation:gt});function ft(){}var ht=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",source:ft});function mt(){}var bt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",target:mt}),St=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",AddOperator:_t,SourceOperator:ht,TargetOperator:bt});const vt="";function z(t){return typeof t=="string"?{name:t}:t}function O(t){return z(t).name||""}const re=new Map;function yt(t,e){const n=new Q;return t.set(e,n),n}function xt(t){const e=new Map,n=new Map,o=new Map,r=new Map,a=new Map,i=new Map;return{name:t,streamMaps:{valueSourceMap:e,instantValueSourceMap:n,changeSourceMap:i,blurSourceMap:o,setValueMap:r,blurValueMap:a},state:{}}}function $t(t){const e=xt(t);return re.set(t,e),e}function wt(t,e){return t.get(e)||yt(t,e)}function Ct(t=vt){return re.get(t)||$t(t)}function W(t,e){const n=z(e);return Ct(n.namespace).streamMaps[t]}function oe(t,e,n){const o=W(t,e),r=O(e);o.set(r,n)}function w(t,e){const n=O(e);return W(t,e).get(n)}function H(t,e){const n=W(t,e);return wt(n,O(e))}function Mt(t,e){oe("setValueMap",t,e)}function ae(t){return H("valueSourceMap",t)}function Ot(t){return H("instantValueSourceMap",t)}function se(t){return H("blurSourceMap",t)}function It(t){const e=w("blurValueMap",t);if(e)return e;const n=ae(t),o=se(t),r=n.pipe(Ne(a=>o.pipe(F(()=>a))));return oe("blurValueMap",t,r),r}function Pt(t){return H("changeSourceMap",t)}function Tt(t,...e){const n=w("setValueMap",t);return n==null?void 0:n(...e)}function ce(t){const{field:e,setValueMethod:n,value:o}=t;_.exports.useMemo(()=>{Mt(e,n)},[n,O(e)]),_.exports.useEffect(()=>{var r;(r=w("valueSourceMap",e))==null||r.next(o)},[o])}function Et(){}function Nt(t){return typeof t=="function"}function U(t){const{children:e,value:n,name:o,onChange:r,namespace:a}=t,i={name:o,namespace:a};ce({field:i,setValueMethod:r,value:n});function d(l){const c=l.target.value,g=w("instantValueSourceMap",i),p=w("changeSourceMap",i);if(g){g.next(c),p==null||p.next(c);return}p==null||p.next(c),r(c)}function u(l){var c;(c=w("blurSourceMap",i))==null||c.next(l)}return M.Children.only(e)?M.cloneElement(e,{value:n,onChange:d,onBlur:u}):Nt(e)?e({handleChange:d,handleBlur:u}):s(I,{children:e})}var Ht=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getFieldConfig:z,getFieldId:O,getValueSource:ae,getInstantValueSource:Ot,getBlurSource:se,getBlurValueSource:It,getChangeSource:Pt,setValue:Tt,useRegisterField:ce,createLogic:Et,Wrap:U});const ie=M.createContext({store:new Map});function Lt(){return _.exports.useContext(ie)}function Rt(t){const e=new Map;return new Function("Rx","operations","link",$,t)(He,St,Ht,e),e}const jt=t=>{const{value:e,children:n}=t,[o,r]=_.exports.useState(new Map),a=_.exports.useMemo(()=>({store:o}),[o]);return _.exports.useEffect(()=>{if(!e)return;const i=Rt(e);console.log({result:i}),i&&r(i)},[e]),s(ie.Provider,{value:a,children:n})};function Ft(t){const{store:e}=Lt(),n=_.exports.useRef(new Q);return _.exports.useEffect(()=>{var a;const r=(a=e.get(t))==null?void 0:a.subscribe((...i)=>{n.current.next(...i)});return()=>{r==null||r.unsubscribe(),n.current.next(void 0)}},[e,t]),Le(()=>n.current)}const kt=()=>{const[t,e]=_.exports.useState(""),[n,o]=_.exports.useState(""),r=Ft("$flow_slgum");return f("div",{style:{display:"grid",gap:16},children:[s(U,{name:"value",value:t,onChange:e,children:s("input",{type:"number"})}),s(U,{name:"value2",value:n,onChange:o,children:s("input",{type:"number"})}),s("output",{children:r})]})},Vt=()=>{const{elements:t}=ke(),[e,n]=_.exports.useState("");return f("div",{children:[s("div",{children:"Console Panel"}),s("br",{}),f("div",{style:{display:"grid",gap:16},children:[s("button",{onClick:()=>{console.log(Z(t))},children:"graph"}),f("button",{onClick:()=>n(We(t)),children:[" ","Compile And Run"," "]})]}),f("div",{children:[s("br",{}),s(jt,{value:e,children:s(kt,{})})]}),s("pre",{children:e})]})},At="_container_1hju3_1",Dt="_main_1hju3_10",Bt="_console_1hju3_13";var ue={container:At,main:Dt,console:Bt};const qt=()=>s("div",{className:ue.container,children:f(Ae,{children:[s(et,{}),s(lt,{}),s(dt,{}),s("div",{className:ue.console,children:s(Vt,{})})]})});function zt(){return s(I,{children:s(qt,{})})}Re.render(s(M.StrictMode,{children:s(zt,{})}),document.getElementById("root"));
